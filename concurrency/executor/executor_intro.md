# 线程池概述

@author Jiawei Mao
***
## 简介

在 Java 中线程的创建和销毁开销都很大，除了任务执行所需的开销，系统还需要为线程分配资源及额外的内存开销。因此反复创建线程开销会很大，降低系统效率。

线程池存放已经创建好的线程，将任务提交给线程池，线程池使用已创建的线程执行任务。线程池使得线程可以重复使用，在降低创建线程的开销的同时简化了线程的管理工作。

线程池复用线程具有以下优点：

- 减少内存开销，创建线程占用内存；
- 降低系统开销，创建线程需要时间，会延迟处理的请求；
- 提高稳定性，避免无限创建线程导致的 `OutOfMemoryError`；
- 将当前任务与主线程分离，实现和主线程的异步执行；
- 实现线程创建和管理的分离。

但是，一味的开线程也不一定能带来性能上的，线池休眠也要占用一定的内存空间，所以要合理地选择线程池的大小。

## 线程池的基本原理

线程池管理一堆已经创建好的线程，并负责执行提交的任务。当提交的任务大于线程池中线程的数目，可以创建新的线程执行任务，也可以将该任务放入一个队列，等其它任务执行完有了空闲线程再执行。因此一个线程池至少需要如下功能：

- 任务队列，用于缓存提交待执行的任务；
- 线程数量管理
  - 初始线程数量, init
  - 线程数量不足时，最大允许的扩充数量, max
  - 线程池空闲时，释放线程，最低保留的线程数目，core
- 拒绝任务策略：如果线程池和队列均已满，需要有相应的策略拒绝任务；
- 线程工厂：用来创建线程；
- `QueueSize`：用来存放提交的 `Runnable` 或 `Callable` 任务。

线程池的基本结构如下所示：

<img src="images/threadpool.png" alt="thread pool" style="zoom: 30%;" />

